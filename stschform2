lblStatus.Location = new Point(30, y);
            lblStatus.Size = new Size(labelWidth, 25);
            this.Controls.Add(lblStatus);

            cmbStatus = new ComboBox();
            cmbStatus.Location = new Point(140, y);
            cmbStatus.Size = new Size(controlWidth, 23);
            cmbStatus.DropDownStyle = ComboBoxStyle.DropDownList;
            cmbStatus.Items.AddRange(new string[] { "Подана", "Рассмотрение", "Принята", "Отклонена", "Ожидание", "Отозвана" });
            this.Controls.Add(cmbStatus);
            y += 40;

            // Комментарий
            Label lblComment = new Label();
            lblComment.Text = "Комментарий:";
            lblComment.Location = new Point(30, y);
            lblComment.Size = new Size(labelWidth, 25);
            this.Controls.Add(lblComment);

            txtComment = new TextBox();
            txtComment.Location = new Point(140, y);
            txtComment.Size = new Size(controlWidth, 60);
            txtComment.Multiline = true;
            txtComment.ScrollBars = ScrollBars.Vertical;
            this.Controls.Add(txtComment);
            y += 80;

            // Кнопки
            Panel buttonPanel = new Panel();
            buttonPanel.Location = new Point(30, y);
            buttonPanel.Size = new Size(330, 50);

            btnSave = new Button();
            btnSave.Text = "Сохранить";
            btnSave.Location = new Point(50, 10);
            btnSave.Size = new Size(100, 35);
            btnSave.BackColor = Color.FromArgb(46, 204, 113);
            btnSave.ForeColor = Color.White;
            btnSave.Click += BtnSave_Click;
            buttonPanel.Controls.Add(btnSave);

            btnCancel = new Button();
            btnCancel.Text = "Отмена";
            btnCancel.Location = new Point(165, 10);
            btnCancel.Size = new Size(100, 35);
            btnCancel.BackColor = Color.FromArgb(149, 165, 166);
            btnCancel.ForeColor = Color.White;
            btnCancel.Click += (s, e) => this.DialogResult = DialogResult.Cancel;
            buttonPanel.Controls.Add(btnCancel);

            this.Controls.Add(buttonPanel);
        }

        private void BtnSave_Click(object sender, EventArgs e)
        {
            try
            {
                string query = @"
                    UPDATE applications 
                    SET Status = @Status,
                        Comments = CONCAT(IFNULL(CONCAT(Comments, '\n'), ''), @NewComment)
                    WHERE ApplicationID = @ApplicationID";
                
                string commentWithDate = $"[{DateTime.Now:dd.MM.yyyy HH:mm}] Статус изменен на: {cmbStatus.Text}\n" +
                                        (string.IsNullOrWhiteSpace(txtComment.Text) ? "" : $"Комментарий: {txtComment.Text}\n");
                
                dbHelper.ExecuteNonQuery(query,
                    new MySqlParameter("@Status", cmbStatus.Text),
                    new MySqlParameter("@NewComment", commentWithDate),
                    new MySqlParameter("@ApplicationID", applicationId));
                
                this.DialogResult = DialogResult.OK;
                this.Close();
            }
            catch (Exception ex)
            {
                MessageBox.Show("Ошибка изменения статуса: " + ex.Message, "Ошибка");
            }
        }
    }
}