using System;
using System.Windows.Forms;

namespace Kursovaya
{
    internal static class Program
    {
        /// <summary>
        /// Главная точка входа для приложения.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);

            try
            {
                // Проверка подключения к БД
                using (var dbHelper = new DatabaseHelper())
                {
                    if (!dbHelper.TestConnection())
                    {
                        MessageBox.Show(
                            "Не удалось подключиться к базе данных!\n\n" +
                            "Убедитесь, что:\n" +
                            "1. MySQL сервер запущен\n" +
                            "2. База данных 'applicant_tracking' создана\n" +
                            "3. Данные для подключения верны",
                            "Ошибка подключения",
                            MessageBoxButtons.OK,
                            MessageBoxIcon.Error
                        );
                        return;
                    }
                }

                // Запуск формы входа
                using (LoginForm loginForm = new LoginForm())
                {
                    // Показываем форму входа как диалоговое окно
                    DialogResult result = loginForm.ShowDialog();
                    
                    // Проверяем результат
                    if (result == DialogResult.OK)
                    {
                        // Успешный вход - запускаем главную форму
                        Application.Run(new MainForm(
                            loginForm.CurrentUsername,
                            loginForm.CurrentRole,
                            loginForm.CurrentFullName
                        ));
                    }
                    else
                    {
                        // Вход отменен или окно закрыто
                        MessageBox.Show("Выход из приложения", "Информация", 
                            MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(
                    $"Критическая ошибка при запуске:\n{ex.Message}",
                    "Ошибка",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error
                );
            }
        }
    }
}